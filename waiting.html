<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ - Duck Shop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(180deg, #0b3c91 0%, #1565c0 55%, #42a5f5 100%);
            margin: 0;
            color: white;
            text-align: center;
            padding: 20px;
        }
        .sticker {
            width: 250px;
            height: 250px;
            margin-bottom: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: white;
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 25px;
        }
        .order-details {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .detail-label {
            opacity: 0.8;
        }
        .detail-value {
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        .steps {
            margin: 30px 0;
        }
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .step.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #42a5f5;
        }
        .step.completed {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
        }
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            flex-shrink: 0;
        }
        .step-text {
            flex: 1;
            text-align: left;
            font-size: 14px;
        }
        .step-status {
            margin-left: 10px;
            font-size: 20px;
        }
        .timer {
            font-size: 20px;
            font-weight: bold;
            margin: 25px 0;
        }
        .timer-value {
            font-size: 24px;
            font-family: 'Courier New', monospace;
            margin-top: 8px;
            color: #42a5f5;
        }
        .loading-dots {
            display: inline-block;
            width: 60px;
            text-align: left;
        }
        .loading-dots::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        .info {
            margin-top: 25px;
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.5;
        }
        .support-link {
            color: #42a5f5;
            font-weight: bold;
            text-decoration: none;
        }
        .support-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="duckAnimation" class="sticker"></div>
    
    <div class="container">
        <h1>‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏</h1>
        <div class="subtitle">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞—à –∫–æ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</div>
        
        <div class="order-details" id="orderDetails">
            <div class="detail-row">
                <span class="detail-label">–ó–∞–∫–∞–∑:</span>
                <span class="detail-value" id="orderId">-</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Email:</span>
                <span class="detail-value" id="orderEmail">-</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">–ö–æ–¥:</span>
                <span class="detail-value" id="orderCode">-</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">–°—É–º–º–∞:</span>
                <span class="detail-value" id="orderAmount">-</span>
            </div>
        </div>
        
        <div class="steps">
            <div class="step completed" id="step1">
                <div class="step-number">1</div>
                <div class="step-text">–û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞</div>
                <div class="step-status">‚úÖ</div>
            </div>
            <div class="step completed" id="step2">
                <div class="step-number">2</div>
                <div class="step-text">–ü–æ—á—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</div>
                <div class="step-status">‚úÖ</div>
            </div>
            <div class="step active" id="step3">
                <div class="step-number">3</div>
                <div class="step-text">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞</div>
                <div class="step-status">‚è≥</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div class="step-text">–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</div>
                <div class="step-status">‚è≥</div>
            </div>
        </div>
        
        <div class="timer">
            –û–∂–∏–¥–∞–Ω–∏–µ<span class="loading-dots"></span>
            <div class="timer-value" id="timerValue">0:00</div>
        </div>
        
        <div class="info">
            ‚ö†Ô∏è –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç<br>
            üìß –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤–∞–º–∏ email<br>
            üîÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥<br>
            <br>
            –ü—Ä–æ–±–ª–µ–º—ã? –ù–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É: 
            <a href="https://t.me/duck_support" class="support-link" target="_blank">@duck_support</a>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const SERVER_URL = 'https://duck-backend-by9a.onrender.com';
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order');
        
        let timerSeconds = 0;
        let checkInterval;
        let timerInterval;
        let orderData = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            lottie.loadAnimation({
                container: document.getElementById('duckAnimation'),
                renderer: 'svg',
                loop: true,
                autoplay: true,
                path: 'duck.json'
            });
            
            if (!orderId) {
                alert('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é...');
                setTimeout(() => {
                    window.location.href = 'Duckshop.html';
                }, 2000);
                return;
            }
            
            await loadOrderData();
            startTimer();
            
            // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–∑—É
            checkOrderStatus();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            checkInterval = setInterval(checkOrderStatus, 5000);
            
            // –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç
            setTimeout(() => {
                clearInterval(checkInterval);
                clearInterval(timerInterval);
                alert('–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.');
                window.location.href = 'Duckshop.html';
            }, 10 * 60 * 1000);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞
        async function loadOrderData() {
            try {
                const response = await fetch(`${SERVER_URL}/api/order-status/${orderId}`);
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    orderData = data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ
                    document.getElementById('orderId').textContent = orderData.order_id || orderId;
                    document.getElementById('orderEmail').textContent = orderData.email || '-';
                    document.getElementById('orderCode').textContent = orderData.code || '-';
                    document.getElementById('orderAmount').textContent = orderData.amount ? `${orderData.amount} ‚ÇΩ` : '-';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã —à–∞–≥–æ–≤
                    updateSteps(orderData.status);
                    
                    // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                    if (orderData.status === 'completed') {
                        redirectWithDelay(`final.html?order=${orderId}`, 1000);
                        return;
                    }
                    
                    if (orderData.status === 'rejected') {
                        redirectWithDelay(`rejected.html?order=${orderId}`, 1000);
                        return;
                    }
                    
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
                
            } catch (error) {
                console.error('Error loading order data:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                document.getElementById('orderId').textContent = orderId || '-';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —à–∞–≥–æ–≤
        function updateSteps(status) {
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 2 —à–∞–≥–∞ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('completed');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥ 3
            const step3 = document.getElementById('step3');
            if (status === 'completed') {
                step3.classList.remove('active');
                step3.classList.add('completed');
                step3.querySelector('.step-status').textContent = '‚úÖ';
            } else if (status === 'rejected') {
                step3.classList.remove('active');
                step3.classList.add('completed');
                step3.querySelector('.step-status').textContent = '‚ùå';
            } else {
                step3.classList.add('active');
                step3.querySelector('.step-status').textContent = '‚è≥';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥ 4
            const step4 = document.getElementById('step4');
            if (status === 'completed') {
                step4.classList.add('active');
                step4.querySelector('.step-status').textContent = '‚úÖ';
            } else if (status === 'rejected') {
                step4.classList.add('active');
                step4.querySelector('.step-status').textContent = '‚ùå';
            } else {
                step4.classList.remove('active', 'completed');
                step4.querySelector('.step-status').textContent = '‚è≥';
            }
        }
        
        // –¢–∞–π–º–µ—Ä
        function startTimer() {
            timerInterval = setInterval(() => {
                timerSeconds++;
                const minutes = Math.floor(timerSeconds / 60);
                const seconds = timerSeconds % 60;
                document.getElementById('timerValue').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
        async function checkOrderStatus() {
            if (!orderId) return;
            
            try {
                const response = await fetch(`${SERVER_URL}/api/order-status/${orderId}`);
                if (!response.ok) return;
                
                const data = await response.json();
                
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    orderData = data;
                    updateSteps(data.status);
                    
                    if (data.status === 'completed') {
                        // –ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω
                        clearInterval(checkInterval);
                        clearInterval(timerInterval);
                        redirectWithDelay(`final.html?order=${orderId}`, 2000);
                    } else if (data.status === 'rejected') {
                        // –ó–∞–∫–∞–∑ –æ—Ç–∫–ª–æ–Ω–µ–Ω
                        clearInterval(checkInterval);
                        clearInterval(timerInterval);
                        redirectWithDelay(`rejected.html?order=${orderId}`, 2000);
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        function redirectWithDelay(url, delay) {
            setTimeout(() => {
                window.location.href = url;
            }, delay);
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                checkOrderStatus();
            }
        });
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
